!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("manba")):"function"==typeof define&&define.amd?define(["manba"],t):(e=e||self,t(e.manba))}(this,function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function o(e){var t={};if(c.isArray(e))return 0==e.length?null:a(e[0]);for(var r=0,n=Object.keys(e);r<n.length;r++){var i=n[r],o=e[i];t[i]=a(o)}return t}function a(e){var t=null;if(e instanceof h)t=e;else if(c.isArray(e))t={type:f.ARRAY,value:o(e)};else if(c.isObject(e)){var r=Object.keys(e).some(function(e){return-1==["type","default","unit","format","parse","dispose","computed","property"].indexOf(e)}),n=y(e.type);n&&!r?(t={},Object.assign(t,e,{type:n})):t={type:f.OBJECT,value:o(e)}}else t={type:v(e)};return t}function l(t,r,n,i){if(r instanceof h)return n.isParse?r.parse(t,n):r.dispose(t,n);if(n.isDispose&&c.isFunction(r.computed))return r.computed.call(null,i);if(n.isDispose&&c.isFunction(r.dispose))return r.dispose.call(null,i);if(n.isParse&&c.isFunction(r.parse))return r.parse.call(null,i);if(void 0===t||null===t){if(r.type==f.ARRAY&&n.isParse)return[];if(r.type!=f.OBJECT||!n.isParse)return n.removeNull||void 0==r.default?null:r.default}var o=t;switch(r.type){case f.OBJECT:if(o={},n.isParse){var a=c.mergeArray(Object.keys(r.value),t?Object.keys(t):[]),s=!0,p=!1,y=void 0;try{for(var v,b=a[Symbol.iterator]();!(s=(v=b.next()).done);s=!0){var m=v.value;if(r.value.hasOwnProperty(m)){t=t||{};var d=l(r.value[m].property?u(t,r.value[m].property):t[m],r.value[m],n,t);if(n.removeNull&&(void 0==d||null==d||c.isArray(d)&&0==d.length))continue;o[m]=d}else o[m]=c.deepCopy(t[m])}}catch(e){p=!0,y=e}finally{try{s||null==b.return||b.return()}finally{if(p)throw y}}}else for(var g=0,O=Object.keys(t);g<O.length;g++){var S=O[g];if(r.value.hasOwnProperty(S)){var A=l(t[S],r.value[S],n,t);if(void 0!=A&&null!=A){if(n.removeEmptyArray&&c.isArray(A)&&0==A.length)continue;o[S]=A}}}0==Object.keys(o).length&&n.removeEmptyObject&&!c.isArray(i)&&(o=null);break;case f.ARRAY:o=[];var N=!0,j=!1,E=void 0;try{for(var B,R=t[Symbol.iterator]();!(N=(B=R.next()).done);N=!0){var T=l(B.value,r.value,n,t);n.removeNullFromArray&&null==T||o.push(T)}}catch(e){j=!0,E=e}finally{try{N||null==R.return||R.return()}finally{if(j)throw E}}break;case f.NUMBER:c.isString(t)&&""==t?o=null:(o=Number(t),r.unit&&(o=n.isParse?c.div(o,r.unit):c.mul(o,r.unit)));break;case f.DATE:o=c.isString(t)&&""==t?null:t?n.isParse?e(t).format(r.format||""):h.disposeDateFormat(t,r.format):null;break;case f.BOOLEAN:o=!0===t||"true"==t||!1!==t&&"false"!=t&&null;break;case f.STRING:o=String(t)}return f.isType(r.type)&&n.isParse&&c.isFunction(r.format)&&o&&(o=r.format.call(null,o)),n.isDispose&&n.setEmptyNull&&c.isString(o)&&""==o&&(o=null),o}function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=c.isArray(t)?t:t.includes(".")?t.split("."):[].push(t),n=(t.length,e[r[0]]);return c.isObject(n)?u(n,r.splice(0,1)&&r):n}function s(e,t,r){var n=null;if(null===e||void 0===e){if(!r.isParse)return null;e={}}if(c.isArray(e)){n=[];var i=!0,o=!1,a=void 0;try{for(var u,s=e[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var f=u.value;n.push(l(f,t,r,e))}}catch(e){o=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw a}}}else if(c.isObject(e)){if(null==(n=l(e,t,r)))return{}}else n=e;return n}e=e&&e.hasOwnProperty("default")?e.default:e;var c={isObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},isArray:function(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)},isDate:function(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)},isNumber:function(e){return e instanceof Number||"[object Number]"===Object.prototype.toString.call(e)},isString:function(e){return e instanceof String||"[object String]"===Object.prototype.toString.call(e)},isBoolean:function(e){return"boolean"==typeof e},isFunction:function(e){return"function"==typeof e},deepCopy:function(e){var t=null;if(this.isObject(e)){t={};for(var r in e)t[r]=this.deepCopy(e[r])}else if(this.isArray(e)){t=[];var n=!0,i=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var u=a.value;t.push(this.deepCopy(u))}}catch(e){i=!0,o=e}finally{try{n||null==l.return||l.return()}finally{if(i)throw o}}}else t=e;return t},deepFreeze:function(e){var t=this,r=this;return Object.freeze(e),Object.keys(e).forEach(function(n,i){r.isObject(e[n])&&t.deepFreeze(e[n])}),e},mergeArray:function(e,t){for(n=0;n<e.length;n++)for(var r=0;r<t.length;r++)e[n]===t[r]&&e.splice(n,1);for(var n=0;n<t.length;n++)e.push(t[n]);return e},extend:function(){var e,r,n,i,o,a,l=arguments[0]||{},u=1,s=arguments.length,c=!1;for("boolean"==typeof l&&(c=l,l=arguments[1]||{},u=2),"object"===t(l)||this.isFunction(l)||(l={}),s===u&&(l=this,--u);u<s;u++)if(null!=(e=arguments[u]))for(r in e)n=l[r],l!==(i=e[r])&&(c&&i&&(this.isPlainObject(i)||(o=this.isArray(i)))?(o?(o=!1,a=n&&this.isArray(n)?n:[]):a=n&&this.isPlainObject(n)?n:{},l[r]=this.extend(c,a,i)):void 0!==i&&(l[r]=i));return l},add:function(e,t){var r=e.toString(),n=t.toString(),i=r.split("."),o=n.split("."),a=2==i.length?i[1]:"",l=2==o.length?o[1]:"",u=Math.max(a.length,l.length),s=Math.pow(10,u);return Number(((r*s+n*s)/s).toFixed(u))},sub:function(e,t){return this.add(e,-t)},mul:function(e,t){var r=0,n=e.toString(),i=t.toString();try{r+=n.split(".")[1].length}catch(e){}try{r+=i.split(".")[1].length}catch(e){}return Number(n.replace(".",""))*Number(i.replace(".",""))/Math.pow(10,r)},div:function(e,t){var r=0,n=0;try{r=e.toString().split(".")[1].length}catch(e){}try{n=t.toString().split(".")[1].length}catch(e){}var i=Number(e.toString().replace(".","")),o=Number(t.toString().replace(".",""));return this.mul(i/o,Math.pow(10,n-r))}},f={STRING:String,DATE:Date,NUMBER:Number,BOOLEAN:Boolean,OBJECT:Object,ARRAY:Array,isType:function(e){return e===this.STRING||e===this.DATE||e===this.NUMBER||e===this.BOOLEAN},S:10,B:100,Q:1e3,W:1e4,SW:1e5,BW:1e6,QW:1e7,Y:1e8};c.deepFreeze(f);var p={removeEmptyArray:!1,removeNull:!1,removeNullFromArray:!1,removeEmptyObject:!0},y=function(e){return null!=e&&(!!f.isType(e)&&e)},v=function(e){return f.isType(e)?e:c.isNumber(e)?f.NUMBER:c.isString(e)?f.STRING:c.isBoolean(e)?f.BOOLEAN:f.STRING},h=function(){function e(t){r(this,e),this._model=a(t)}return i(e,[{key:"parse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.isParse=!0,t.isDispose=!1,s(e,this._model,c.extend({},p,t))}},{key:"dispose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.isParse=!1,t.isDispose=!0,s(e,this._model,c.extend({},p,t))}}]),e}();h.DATE=f.DATE,h.NUMBER=f.NUMBER,h.STRING=f.STRING,h.BOOLEAN=f.BOOLEAN,h.Date=f.DATE,h.Number=f.NUMBER,h.String=f.STRING,h.Boolean=f.BOOLEAN,h.S=f.S,h.B=f.B,h.Q=f.Q,h.W=f.W,h.SW=f.SW,h.BW=f.BW,h.QW=f.QW,h.Y=f.Y,h.disposeDateFormat=function(t,r){return e(t).toISOString()},h.config=function(e){c.isFunction(e.disposeDateFormat)&&(h.disposeDateFormat=e.disposeDateFormat)},module.exports=h});
